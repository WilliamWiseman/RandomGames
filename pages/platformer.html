<!DOCTYPE html>
<html>
    <head>
        <title>Platformer</title>
    </head>
    <body>
        <style>
            html{
                width:100%;
            }
            body{
                width:100%;
            }
            canvas {
            z-index: 1;
            position: absolute;
            left: 0;
            top: 0;
            width: 100vw;
        }


        </style>

    <canvas id="game" width="1024" height="576"></canvas>

        <script>
            const pixelSize = window.innerWidth / 1024;
            const canvas = document.getElementById("game");
            canvas.style.height = `${pixelSize * 576}px`;
            const ctx = canvas.getContext("2d", { willReadFrequently: true });
            let canMove = true;
            let timer;
            let fps = 60;
            ctx.fillStyle = "red";
            ctx.fillRect(0, 550, 1024, 26);

        function creature(x, y, width, height){
            this.t = false;
            this.x = x;
            this.y = y;
            this.width = width;
            this.height = height;
            this.momX = 0;
            this.momY = 0;
            this.canJump = false;

            creature.prototype.move = function(){
                this.y+= Math.floor(this.momY * dt);
                if(this.t){
                    this.x+= Math.ceil(this.momX * dt);
                }else{
                    this.x+= Math.floor(this.momX * dt);
                }
                for(let i = 0; i < this.height / 2; i++){
                    if(getColor(this.x + Math.floor((this.width / 3)), this.y + this.height / 2 + i)){
                        this.y-= (this.height / 2) - i;
                        this.momY = 0;
                        this.canJump = true;
                    }else if(getColor(this.x + Math.floor((this.width / 3) * 2), this.y + this.height / 2 + i)){
                        this.y-= (this.height / 2) - i;
                        this.momY = 0;
                        this.canJump = true;
                    }
                }

                ctx.fillStyle = 'blue';
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
        }

        let box = new creature(50, 10, 50, 50);
            
        document.addEventListener("keydown", function (event) {
            event.preventDefault();
            let key = event.key;
            key = key.toLowerCase();
            switch (key) {
                case "a":
                case "arrowleft":
                box.momX = -300;
                    break;
                case "d":
                case "arrowright":
                box.momX = 300;
                    break;
                case "w":
                    break;
                case "s":
                    break;
                case " ":
                    if(box.canJump){
                    box.momY = -200;
                    box.canJump = false;
                    }
                    break;
            }
        });

        document.addEventListener("keyup", function (event) {
            event.preventDefault();
            let key = event.key;
            key = key.toLowerCase();
            switch (key) {
                case "a":
                case "arrowleft":
                    if(box.momX < 0){
                box.momX = 0;
                box.t = false;
                    }
                    break;
                case "d":
                case "arrowright":
                    if(box.momX > 0){
                box.momX = 0;
                box.t = true;
                    }
                    break;
                case "w":
                    break;
                case "s":
                    break;
                case " ":
                    if(box.canJump){
                    box.momY = -15;
                    box.canJump = false;
                    }
                    break;
            }
        });

        function collision(a, b) {
            return !(
                ((a.y + a.height) < (b.y)) || //checks if a is higher than b's y
                (a.y > (b.y + b.height)) || // checks if b is lower  than a's y
                ((a.x + a.width) < b.x) || // checks if a is more left than b 
                (a.x > (b.x + b.width))// checks if a is more right than b
            );
        };

        function getColor(x, y) {
            const imgdata = ctx.getImageData(x, y, 1, 1);
            const red = imgdata.data[0];
            return red;
        };

        let lastTime = performance.now();
        let dt;

        function gameLoop(now){
            dt = (now - lastTime) / 1000;
            lastTime = now;
            dt = Math.min(dt, 0.1);
            
            
            ctx.clearRect(0, 0, 1024, 576);
            ctx.fillStyle = "red";
            ctx.fillRect(0, 550, 1024, 26);
            ctx.beginPath();
            ctx.moveTo(480, 570);
            ctx.lineTo(600, 500);
            ctx.lineTo(700, 570);
            ctx.strokeStyle = 'red';
            ctx.lineWidth = 10;
            ctx.stroke();
            
            box.momY+= 10;
            box.move();
            canMove = false;
            
            requestAnimationFrame(gameLoop);
        }
        requestAnimationFrame(gameLoop);
        </script>
    </body>
</html>
