<!DOCTYPE html>
<html>
    <head>
        <title>Platformer</title>
    </head>
    <body>
        <style>
            html{
                width:100%;
            }
            body{
                width:100%;
            }
            canvas {
            z-index: 1;
            position: absolute;
            left: 0;
            top: 0;
            width: 100vw;
        }


        </style>

    <canvas id="game" width="1024" height="576"></canvas>

        <script>
            const pixelSize = window.innerWidth / 1024;
            const canvas = document.getElementById("game");
            canvas.style.height = `${pixelSize * 576}px`;
            const ctx = canvas.getContext("2d", { willReadFrequently: true });
            let canMove = true;
            let timer;
            let fps = 60;
            ctx.fillStyle = "red";
            ctx.fillRect(0, 550, 1024, 26);

        function creature(x, y, width, height){
            this.x = x;
            this.y = y;
            this.width = width;
            this.height = height;
            this.momX = 0;
            this.momY = 0;
            this.canJump = false;

            creature.prototype.move = function(){
                this.y+= this.momY;
                this.x+= this.momX;
                for(let i = 0; i < this.height / 2; i++){
                    if(getColor(this.x + Math.floor((this.width / 3)), this.y + this.height / 2 + i)){
                        this.y-= (this.height / 2) - i;
                        this.momY = 0;
                        this.canJump = true;
                    }else if(getColor(this.x + Math.floor((this.width / 3) * 2), this.y + this.height / 2 + i)){
                        this.y-= (this.height / 2) - i;
                        this.momY = 0;
                        this.canJump = true;
                    }
                }

                ctx.fillStyle = 'blue';
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
        }

        let box = new creature(50, 10, 50, 50);
            
        document.addEventListener("keydown", function (event) {
            event.preventDefault();
            let key = event.key;
            key = key.toLowerCase();
            switch (key) {
                case "a":
                case "leftarrow":
                box.momX = -10;
                    break;
                case "d":
                case "rightarrow":
                box.momX = 10;
                    break;
                case "w":
                    break;
                case "s":
                    break;
                case " ":
                    if(box.canJump){
                    box.momY = -10;
                    box.canJump = false;
                    }
                    break;
            }
        });

        document.addEventListener("keyup", function (event) {
            event.preventDefault();
            let key = event.key;
            key = key.toLowerCase();
            switch (key) {
                case "a":
                case "leftarrow":
                    if(box.momX < 0){
                box.momX = 0;
                    }
                    break;
                case "d":
                case "rightarrow":
                    if(box.momX > 0){
                box.momX = 0;
                    }
                    break;
                case "w":
                    break;
                case "s":
                    break;
                case " ":
                    if(box.canJump){
                    box.momY = -15;
                    box.canJump = false;
                    }
                    break;
            }
        });

        function collision(a, b) {
            return !(
                ((a.y + a.height) < (b.y)) || //checks if a is higher than b's y
                (a.y > (b.y + b.height)) || // checks if b is lower  than a's y
                ((a.x + a.width) < b.x) || // checks if a is more left than b 
                (a.x > (b.x + b.width))// checks if a is more right than b
            );
        };

        function getColor(x, y) {
            const imgdata = ctx.getImageData(x, y, 1, 1);
            const red = imgdata.data[0];
            return red;
        };

        function gameLoop(){
            if(canMove){
            ctx.clearRect(0, 0, 1024, 576);
            ctx.fillStyle = "red";
            ctx.fillRect(0, 550, 1024, 26);
            ctx.beginPath();
            ctx.moveTo(480, 570);
            ctx.lineTo(600, 500);
            ctx.lineTo(700, 570);
            ctx.strokeStyle = 'red';
            ctx.lineWidth = 10;
            ctx.stroke();
            
            box.momY++;
            box.move();
            canMove = false;
            if(timer){
                clearTimeout(timer);
            }
            timer = setTimeout(function(){
                canMove = true;
            }, 1000 / fps);
            }
            requestAnimationFrame(gameLoop);
        }
        requestAnimationFrame(gameLoop);
        </script>
    </body>
</html>
