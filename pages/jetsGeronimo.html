<!DOCTYPE html>

<html>

<body>
    <style>
    	html {
        	height:100%;
        }
        
        body {
            text-align: center;
            background-color: rgb(99, 186, 99);
            height:100%;
        }

        .gameArea {
            text-align: center;
        }
        canvas {
            z-index: 1;
            background-color:white;
            border:2px solid black;
        }
        .entity {
            z-index: 3;
            position:absolute;
            left:0;
            top:0;
        }
    </style>
    
    <div id="add" class="gameArea"></div>
    <img id="boss" src="https://raw.githubusercontent.com/WilliamWiseman/RandomGames/main/images/WillBoss.gif">
    <canvas id="game" width="500" height="500"></canvas>
    
    <script>
        const pixelSize = window.innerHeight / 1000;
        const widthSize = window.innerWidth / 1000;
        let timer;
        const canvas = document.getElementById("game");
        let boss = document.getElementById('boss');
        boss.style = `position:absolute;z-index:2;width:${pixelSize * 500}px;height:${pixelSize * 300}px;left:${(window.innerWidth / 2) - (250 * pixelSize)}px;top:0;`
        canvas.style = `z-index: 1;background-color:white;border:3px solid black;position:absolute;width:${pixelSize * 500}px;height:${pixelSize * 500}px;`;
        canvas.style.left = ((window.innerWidth / 2) - (250 * pixelSize)) + "px";
        canvas.style.top = 300 * pixelSize + "px";
        const ctx = canvas.getContext("2d", { willReadFrequently: true });
        let attackArr = [];
    	let fps = 60; //how many times things move a second, not render
        let canMove = true;
        let player = {
            x:225,
            y:225,
            width:50,
            height:50,
            momX:0,
            momY:0,
            leftJet:false,
            rightJet:false,
            img:false
        };
        player.img = document.createElement('img');
        player.img.className = "entity";
        player.img.src = "https://raw.githubusercontent.com/WilliamWiseman/RandomGames/main/images/Heart.gif";
        player.img.style.top = `${(canvas.style.top.replace('px', '') * 1) + (player.y * pixelSize)}px`;
        player.img.style.left = `${(canvas.style.left.replace('px', '') * 1) + (player.x * pixelSize)}px`;
        player.img.style.width = `${player.width * pixelSize}px`;
        player.img.style.height = `${player.height * pixelSize}px`;
        document.body.appendChild(player.img);
        
        function hitbox(x, y, width, height) {
            this.x = x;
            this.y = y;
            this.width = width;
            this.height = height;
            return this;
        }
        
        document.addEventListener("keydown", function (event) {
            event.preventDefault();
            let key = event.key;
            key = key.toLowerCase();
            switch (key) {
                case "a":
                    player.leftJet = true;
                    //check/change sprite
                    break;
                case "d":
                    player.rightJet = true;
                    //check/change sprite
                    break;
                case "arrowleft":
                    player.leftJet = true;
                    //check/change sprite
                    break;
                case "arrowright":
                    player.rightJet = true;
                    //check/change sprite
                    break;
            }
        });
        
        document.addEventListener("keyup", function (event) {
            event.preventDefault();
            let key = event.key;
            key = key.toLowerCase();
            switch (key) {
                case "a":
                    player.leftJet = false;
                    //check/change sprite
                    break;
                case "d":
                    player.rightJet = false;
                    //check/change sprite
                    break;
                case "arrowleft":
                    player.leftJet = false;
                    //check/change sprite
                    break;
                case "arrowright":
                    player.rightJet = false;
                    //check/change sprite
                    break;
            }
        });
        
        function collision(a, b) {
            return !(
                ((a.y + a.height) < (b.y)) || //checks if a is higher than b's y
                (a.y > (b.y + b.height)) || // checks if b is lower  than a's y
                ((a.x + a.width) < b.x) || // checks if a is more left than b 
                (a.x > (b.x + b.width))// checks if a is more right than b
            );
        };
        
        function getColor(x, y) {
            const imgdata = ctx.getImageData(x, y, 1, 1);
            const red = imgdata.data[0];
            return red;
        };
        
        function startGameLoop(){
        requestAnimationFrame(gameLoop);
        }
        function die(){
        player.momX = 0;
        player.momY = 0;
        player.x = 225;
        player.y = 225;
        canMove = false;
        if(timer){
        clearTimeout(timer);
        }
        timer = setTimeout(() => {
        canMove = true;
        }, 1000);
        }
        function gameLoop(){
        
        if (canMove) {
            player.momY++;//Gravity exists, no?

            if(player.leftJet){
                player.momX+=1;
                player.momY-=1.5;
            }
            if(player.rightJet){
                player.momX-=1;
                player.momY-=1.5;
            }
            player.momX = Math.floor(player.momX);
            if(player.momX > 15){//We NEED a speed limit
                player.momX = 15;
            }else if(player.momX < -15){
                player.momX = -15;
            }
            player.momY = Math.floor(player.momY);
            if(player.momY > 15){//We NEED a speed limit
                player.momY = 15;
            }else if(player.momY < -10){
                player.momY = -10;
            }

            //player.momX = Math.floor(player.momX - (player.momX / 5)); //Air resistance? quite choppy atm

                player.x += player.momX;
                if (
                    getColor(player.x, player.y) !== 0 ||
                    getColor(player.x + player.width -1, player.y) !== 0 ||
                    getColor(player.x, player.y + player.height -1) !== 0 ||
                    getColor(player.x + player.width -1, player.y + player.height -1) !== 0 ||
                    player.x < 0 ||
                    player.x + player.width > canvas.width
                ) {
                    die();
                }
                player.y += player.momY;
                if (
                    getColor(player.x, player.y) !== 0 ||
                    getColor(player.x + player.width -1, player.y) !== 0 ||
                    getColor(player.x, player.y + player.height -1) !== 0 ||
                    getColor(player.x + player.width -1, player.y + player.height -1) !== 0 ||
                    player.y < 0 ||
                    player.y + player.height > canvas.height
                ) {
                    die();
                }

                //attacks to deal with
                for(let i = 0; i < attackArr.length; i++){
                    //cycle through to subtract frames from attacks
                }
                canMove = false;
                if(timer){
                    clearTimeout(timer);
                }
                timer = setTimeout(() => {
                    canMove = true;
                }, 1000 / fps);
            }
        player.img.style.top = `${(canvas.style.top.replace('px', '') * 1) + (player.y * pixelSize)}px`;
        player.img.style.left = `${(canvas.style.left.replace('px', '') * 1) + (player.x * pixelSize)}px`;
            requestAnimationFrame(gameLoop);
        };

        requestAnimationFrame(gameLoop);

        
    </script>

</body>

</html>
